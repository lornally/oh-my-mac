###### 尝试的内容

- hfsfuse, 并没有什么卵用
- testdisk, 虽然可以brew安装, 
  - 但是, 也没有什么卵用
  - 但是, 大神说有用
  - https://www.cgsecurity.org/wiki/TestDisk
  - testdisk官方推荐: https://www.cgsecurity.org/wiki/PhotoRec

###### 一般方法

1. disk utility

2. diskutil

   ```sh
   diskutil list
   diskutil verifyVolume /dev/rdisk2
   diskutil repairvolume /dev/rdisk2
   diskutil verifyDisk /dev/rdisk2
   diskutil repairDisk /dev/rdisk2
   ```

3. fsck

   ```sh
   sudo fsck -fy /dev/rdisk2
   fsck_hfs -fy -x /dev/rdisk3s2
df -h1 # 列出磁盘
   ```
   

###### hfsfuse 

- 这个项目很傻, 直接用源文件不行的. 必须用release的zip包才行
- 甚至于直接用tar.gz的包都不可以, 当然也可能这个包是不必编译, 可以直接使用的.

命令:

```sh
sudo hfsfuse --force -o noatime /dev/disk2 /Users/bergman/Downloads/hfsd
```

###### testdisk

- 选择rdisk而不是disk, 这样能快一点.

```sh
sudo testdisk
sudo pdisk /dev/rdisk3
# c 命令报错
# i 命令回车多次
# 再次c命令建第一个分区, 使用start和size in sectors
# 依次用c命令建好分区
# w 命令写入
# q 命令退出
# 然后重新启动机器
```

- testdisk的参数

```sh
     Partition     Start        End    Size in sectors
 1 P EFI System    40     409639     409600 [EFI System Partition]
 2 P Mac HFS       473981 1953327324 1952853344
 
 Disk /dev/rdisk3 - 1000 GB / 931 GiB - 1953525168 sectors
Analyse sector      360448/1953525167: 00%
Read error at 360447/0/1 (lba=360447)

check_FAT: Unusual media descriptor (0xf0!=0xf8)
Warning: number of heads/cylinder mismatches 16 (FAT) != 1 (HD)
Warning: number of sectors per track mismatches 32 (FAT) != 1 (HD)
  EFI System                    40     409639     409600 [EFI System Partition] [EFI]
check_FAT: Unusual media descriptor (0xf0!=0xf8)
Warning: number of heads/cylinder mismatches 16 (FAT) != 1 (HD)
Warning: number of sectors per track mismatches 32 (FAT) != 1 (HD)
  EFI System                    46     409645     409600 [EFI System Partition] [EFI]
  
Disk /dev/rdisk3 - 1000 GB / 931 GiB - 1953525168 sectors
     Partition               Start        End    Size in sectors
>P EFI System                    40     409639     409600 [EFI System Partition]
 P Mac HFS                   473981 1953327324 1952853344

```



###### 参考文档

- 这里的方法主要是hfsfuse, 没啥卵用, https://swissmacuser.ch/hfs-volume-data-recovery-diskutility-could-not-mount-error-49153/
- testdisk的方法: https://perrohunter.com/repair-a-mac-os-x-hfs-partition-table/
- 一般性的方法: https://www.datanumen.com/blogs/5-tips-repair-corrupted-hierarchical-file-system-hfs-volume-mac/

